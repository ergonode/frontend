/*
 * Copyright Â© Bold Brand Commerce Sp. z o.o. All rights reserved.
 * See LICENSE for license details.
 */
<template>
    <div :class="editCellClasses">
        <Component
            :is="editableComponent"
            v-model="localValue"
            :error-messages="errorMessages"
            :options="options"
            :parameters="parameters"
            :multiselect="isMultiSelect"
            :fixed-width="fixedWidth"
            @imageid="onImageIDChange"
            @focus="onFocus" />
    </div>
</template>

<script>
export default {
    name: 'GridEditActivatorCell',
    props: {
        storeNamespace: {
            type: String,
            required: true,
        },
        value: {
            type: [String, Number, Array, Boolean],
            required: true,
        },
        type: {
            type: String,
            default: null,
        },
        isSelectKind: {
            type: Boolean,
            default: false,
        },
        isMultiSelect: {
            type: Boolean,
            default: false,
        },
        options: {
            type: Array,
            default: () => [],
        },
        parameters: {
            type: Object,
            default: () => {},
        },
        errorMessages: {
            type: [String, Array],
            default: '',
        },
        fixedWidth: {
            type: Number,
            required: true,
        },
    },
    data() {
        return {
            localValue: this.value,
        };
    },
    destroyed() {
        this.$emit('updateValue', this.localValue);
    },
    computed: {
        editCellClasses() {
            return [
                'edit-cell',
            ];
        },
        isTextAreaType() {
            return this.type === 'TEXT_AREA';
        },
        isImageType() {
            return this.type === 'IMAGE';
        },
        isDateType() {
            return this.type === 'DATE';
        },
        editableComponent() {
            if (this.isSelectKind) return () => import('~/components/Grid/EditCells/GridEditSelectCell');
            if (this.isTextAreaType) return () => import('~/components/Grid/EditCells/GridEditLongTextCell');
            if (this.isImageType) return () => import('~/components/Grid/EditCells/GridEditImageCell');
            if (this.isDateType) return () => import('~/components/Grid/EditCells/GridEditDateCell');

            return () => import('~/components/Grid/EditCells/GridEditShortTextCell');
        },
    },
    methods: {
        onImageIDChange(id) {
            this.localValue = id;
        },
        onFocus(isFocused) {
            if (!isFocused) {
                this.$store.dispatch(`${this.storeNamespace}/setEditingCellCoordinates`);
            }
        },
    },
};
</script>

<style lang="scss" scoped>
    .edit-cell {
        position: fixed;
        z-index: 999;
        display: flex;
        justify-content: center;
    }
</style>
